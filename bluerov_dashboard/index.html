<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>BlueROV Dashboard</title>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />

  <script src="assets/js/lib/jquery.min.js" type="text/javascript"></script>
  <script src="assets/js/lib/bootstrap.min.js" type="text/javascript"></script>
  <script src="assets/js/lib/bootstrap-table.min.js" type="text/javascript"></script>
  <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="assets/css/bootstrap-table.min.css" rel="stylesheet" type="text/css" />
  <script src="assets/js/lib/moment.js" type="text/javascript"></script>
  <script src="assets/js/lib/Chart.min.js" type="text/javascript"></script>
  <script src="assets/js/lib/chartjs-plugin-streaming.min.js" type="text/javascript"></script>
  <script src="assets/js/lib/roslib.min.js" type="text/javascript"></script>
  <script src="assets/js/lib/eventemitter2.min.js" type="text/javascript"></script>
  <script src="assets/js/listener.js" type="text/javascript"></script>
  <script src="assets/js/lib/holder.min.js" type="text/javascript"></script>
  <script>
    Holder.add_theme("white", { background: "#fff", foreground: "#a7a7a7", size: 10 });
  </script>
  <script type="text/javascript">
    var ros = new ROSLIB.Ros({
      url: 'ws://localhost:9090'
    });
    ros.on('connection', function () {
      console.log('Connected to websocket server ', ros.socket.url);
    });

    ros.on('error', function (error) {
      console.log('Error connecting to websocket server: ', error);
    });

    ros.on('close', function () {
      console.log('Connection to websocket server closed.');
    });

    var imu = null;
    var imu_count = 0, imu_t0 = null, imu_s0 = 0;
    var imu_sub = new ROSLIB.Topic({
      ros: ros,
      name: '/vn100/imu/raw',
      messageType: 'sensor_msgs/Imu'
    });

    imu_sub.subscribe(function (message) {
      imu = message;
      if (imu_count == 0) {
        imu_t0 = to_sec(imu)
      }
      imu_count++;
      imu_s0 = new Date().getTime() / 1000;
    });

    var dvl = null;
    var dvl_count = 0, dvl_t0 = null, dvl_s0 = 0;
    var dvl_sub = new ROSLIB.Topic({
      ros: ros,
      name: '/rti/body_velocity/raw',
      messageType: 'rti_dvl/DVL'
    });

    dvl_sub.subscribe(function (message) {
      dvl = message;
      if (dvl_count == 0) {
        dvl_t0 = to_sec(dvl)
      }
      dvl_count++;
      dvl_s0 = new Date().getTime() / 1000;
    });

    var depth = null;
    var depth_count = 0, depth_t0 = null, depth_s0 = 0;
    var depth_sub = new ROSLIB.Topic({
      ros: ros,
      name: '/bar30/depth/raw',
      messageType: 'bar30_depth/Depth'
    })

    depth_sub.subscribe(function (message) {
      depth = message;
      if (depth_count == 0) {
        depth_t0 = to_sec(depth)
      }
      depth_count++;
      depth_s0 = new Date().getTime() / 1000;
    });

    window.onload = function () {
      init_imu_listener();
      init_dvl_listener();
      init_depth_listener();

      init_camera_state();
      init_sonar_state();
      var myVar = setInterval(update_sensor_rate, 3000);
    }
  </script>

  <!-- Dashboard -->
  <link rel="stylesheet" type="text/css" href="assets/css/keen-dashboards.css" />
</head>

<body class="keen-dashboard" style="padding-top: 50px;">
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-6">
        <div class="row">
          <div class="col-sm-6">
            <div class="chart-wrapper">
              <div class="chart-title">
                VN100 IMU Linear Acceleration (m/s/s)
              </div>
              <canvas id="imu_a"></canvas>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="chart-wrapper">
              <div class="chart-title">
                VN100 IMU Angular Velocity (rad/s)
              </div>
              <canvas id="imu_w"></canvas>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-6">
            <div class="chart-wrapper">
              <div class="chart-title">
                VN100 IMU Orientation (deg)
              </div>
              <canvas id="imu_e"></canvas>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="chart-wrapper">
              <div class="chart-title">
                RTI DVL Body Velocity (m/s)
              </div>
              <canvas id="dvl"></canvas>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-6">
            <div class="chart-wrapper">
              <div class="chart-title">
                Bar30 Depth (m)
              </div>
              <canvas id="depth"></canvas>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="chart-wrapper">
              <div class="chart-title">
                Sensor rate
              </div>
              <table data-toggle="table" id="table" data-row-style="sensor_rate_row_style">
                <thead>
                  <tr>
                    <th data-field="sensor">Sensor</th>
                    <th data-field="rate">Rate (Hz)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="danger" id="imu_rate">
                    <td>VN100 IMU</td>
                    <td>0</td>
                  </tr>
                  <tr class="danger" id="dvl_rate">
                    <td>RTI DVL</td>
                    <td>0</td>
                  </tr>
                  <tr class="danger" id="depth_rate">
                    <td>Bar30 Depth</td>
                    <td>0</td>
                  </tr>
                  <tr class="danger" id="gps_rate">
                    <td>Water Linked GPS</td>
                    <td>0</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="row justify-content-md-center">
          <div class="col-md-auto">
            <div class="chart-title">
              <button id="camera_btn" type="button" class="btn btn-dark">Camera</button>
            </div>
            <div class="chart-wrapper">
              <img id="camera" data-src="holder.js/100%x300/white/text:Camera" height="300"></img>
            </div>
          </div>
        </div>
        <div class="row justify-content-md-center">
          <div class="col-md-auto">
            <div class="chart-title">
              <button id="sonar_btn" type="button" class="btn btn-dark">Sonar Oculus</button>
            </div>
            <div class="chart-wrapper">
              <img id="sonar" data-src="holder.js/100%x400/white/text:Sonar Oculus" height="400" width="auto"></img>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>